Исходный код сайта выложен в открытый репозиторий под лицензией MIT.

Но сами данные для построения сайта (тексты, посты, страницы, изображения и тп) расположены в отдельном защищенном репозитории, что не позволяет скопировать сайт путем простого клонирования.

## Предварительные условия

1. Учетная запись на [SendGrid](https://sendgrid.com). Необходимо получить API key и верифицировать ваш e-mail (Single Sender).
2. Учетная запись на [GitHub](https://github.com).
3. Учетная запись на [Netlify](https://netlify.com).
4. Предвариельно установленное ПО на вашем локальном компьютере:
   - система контроля версий **Git**. Ссылка для скачивания [здесь](https://git-scm.com/download)
   - NodeJs. Ссылка для скачивания [здесь](https://nodejs.dev/download).
5. Права доступа к исходному защищенному репозиторию с данными.


## Установка Netlify-CLI

1. Запустите командную строку в режиме Администратора.
2. Выполните команду:

   ```bash
   npm i -g netlify-cli
   ```

## Создание нового сайта на Netlify

1. Запустите командную строку.
2. Выполните команду:

   ```bash
   netlify  sites:create --name ИМЯ-ВАШЕГО-САЙТА
   ```

3. После создания сайта скопируйте с экрана терминала **Site ID**.

## Создание токена доступа к API Netlify

1. Откройте браузер и зайдите в вашу учетную запись на [Netlify](https://www.netlify.com/).
2. User Settings -> Application -> New Access Token.
3. Сгенерируйте токен с именем **NETLIFY_AUTH_TOKEN**.
4. Скопируйте содержимое токена.

:bulb: Токен **NETLIFY_AUTH_TOKEN** - важная информация для управления сайтом. Храните его в надежном месте, чтобы исключить утечку.

## Клонирование данных сайта из защищенного репозитория-источника

1. Откройте браузер и зайдите в вашу учетную запись на [GitHub](https://github.com).
1. Откройте браузером защищенный репозиторий-источник с данными сайта по [этой ссылке](https://github.com/alextim/s-bars.content).
1. Создайте fork из репозитория-источника - нажмите кнопку **Fork** (правый верхний угол страницы).
1. После завершения процесса нажмите кнопку **Code**.
1. Скопируйте URL вашего репозитория.  
   Адрес будет выглядеть, как здесь: `https://github.com/ИМЯ-ВАШЕЙ-УЧЕТНОЙ-ЗАПИСИ/s-bars.content.git`.
1. Запустите командную строку на вашем компьютере.  
1. Перейдите в желаемую папку при помощи команды `cd` (change directory).
1. Клонируйте ваш репозиторий-fork в выбранную папку следующей командой:

```sh
git clone https://github.com/ИМЯ-ВАШЕЙ-УЧЕТНОЙ-ЗАПИСИ/s-bars.content.git
```

## Настройка удаленного репозитория

1. Получите токен доступа к API (права: *read:repo_hook, repo*) от поставщика услуги генерации сайта. Храните этот токен в секрете!
1. Зайдите в вашу учетную запись на [Github](https://github.com).
1. Откройте ваш репозиторий с данными.
1. Settings -> Secrets -> New repository secret.
1. Создайте новый секрет с именем **API_TOKEN** и значением полученного токена.

## Настройка секретов репозитория с кодом

Репозиторий с кодом находится [здесь](https://github.com/alextim/s-bars) в открытом доступе.

Все секреты репозитория полностью защищены. Их невозможно просмотреть, можно только или удалить или создать новые.


Данные вашего сайта закрыты для просмотра извне.


### Данные от вас для секретов репозитория

|  Key                  | Value                  | Комментарий
|---                    |---                     |---
| NETLIFY_AUTH_TOKEN    |                        | конфиденциальная информация!
| NETLIFY_SITE_ID       | **Site ID**            |
| SENDGRID_API_KEY      | ваш SendGrid API ключ  | конфиденциальная информация!
| SENDGRID_SINGE_SENDER | ваш e-mail, верифицированный SendGrid
| TO_EMAIL              | e-mail, на который будут приходить сообщения из форм
| NO_INDEX              | true, если надо запретить индексирование всего сайта

### Данные от поставщика для секретов репозитория

|  Key                  | Value
|---                    |---
| ACCESS_TOKEN          | права *read:repo_hook, repo*
| NPM_TOKEN             | права *read:packages*
| TELEGRAM_TOKEN        | токен Telegram-бота
| TELEGRAM_TO           | ID Telegram-канала
| WARNINGS              | true

## Настройка хостинга сайта

1. Зайдите в вашу учетную запись на [Netlify](https://www.netlify.com/).
1. Sites -> ВАШ-САЙТ -> Deploys -> Deploy settings.
1. Перейдите в Environment -> Environment variables

   Создайте переменные окружения.

   Значения переменных из предыдущего подраздела.

   |  Key                  | Value
   |---                    |---
   | SENDGRID_API_KEY      | ваш SendGrid API ключ
   | SENDGRID_SINGE_SENDER | ваш e-mail, верифицированный SendGrid
   | TO_EMAIL              | e-mail, на который будут приходить сообщения из форм
   | TELEGRAM_TOKEN        | Токен Telegram-бота
   | TELEGRAM_TO           | ID Telegram-канала


Если ваш сайт ранее был подключен к репозиторию, а также был настроен встроенный CD от Netlify, то потребуется отключение сайта от репозитория и остановка автоматической генерации.

1. Зайдите в вашу учетную запись на [Netlify](https://www.netlify.com/).
1. Перейдите в Continuos Deployment -> Build settings -> Edit settings

   Выберите Stop builds и нажмите Save.
1. Перейдите в Deploy contexts и установите следующие значения:
   - Production branch: main
   - Deploy previews: none
   - Branch deploys: none

*Возможно для корректной работы Netlify-CLI в составе GitHub Actions дополнительно потребуются действия описанные [здесь](https://github.com/netlify/cli/issues/1251#issuecomment-808947876).*

